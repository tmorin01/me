<!DOCTYPE HTML>
<!--
	Generic Page - tmmorin.com

             Author: Tom Morin
        Description: Story about how I 3d-printed my brain

	Design:
	Massively by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<script src="https://www.w3schools.com/lib/w3.js"></script>
	<head>
		<meta property="og:site_name" content="Tom Morin"/>
                <meta property="og:title" content="How to 3D Print Your Brain"/>
                <meta property="og:description" content="A few months ago, I 3d printed my brain. Here's a tutorial for anyone who's interested."/>
                <meta property="og:image" content="images/me_and_my_brain.jpg"/>
                <meta property="og:url" content="http://tmmorin.com/3dbrain.html">
                <meta property="og:type" content="blog"/>
		<title>3D Printed Brain</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
		<link rel="shortcut icon" href="images/favicon.png" />
		<link rel="stylesheet" href="assets/css/academicons.min.css"/>

		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-80555893-1"></script>
		<script>
  		window.dataLayer = window.dataLayer || [];
  		function gtag(){dataLayer.push(arguments);}
  		gtag('js', new Date());

  		gtag('config', 'UA-80555893-1');
		</script>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

        			<!-- Header -->
        			<header id="header">
                			<a href="index.html" class="logo">Thomas Morin</a>
        			</header>

        			<!-- Nav Bar -->
        			<nav id="nav">
			                <ul class="links">
			                        <li><a href="index.html">Home</a></li>
			                        <li><a href="about.html">About</a></li>
			                        <li><a href="work.html">Work</a></li>
			                        <li><a href="brain_images.html">Brain</a></li>
			                </ul>
			                <ul class="icons">
			                        <li><a href="https://twitter.com/ThomasMorin1" target="_blank" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
			                        <li><a href="https://www.linkedin.com/in/thomas-morin-23b196b2" target="_blank" class="icon fa-linkedin"><span class="label">LinkedIn</span></a></li>
			                        <li><a href="https://github.com/tmorin01" target="_blank" class="icon fa-github"><span class="label">GitHub</span></a></li>
			                        <li><a href="https://scholar.google.com/citations?user=DYfllzQAAAAJ" target="_blank" class="ai ai-google-scholar"><span class="label"></span></a></li>
			                </ul>
			        </nav>

				<!-- Main -->
					<div id="main">

						<!-- Post -->
							<section class="post">
								<header class="major">
									<span class="date">December 5, 2018</span>
									<h1>I 3D-printed my brain!</h1>
									<p>A few months ago Matt, another grad student in the lab, suggested that
										we try to 3D-print our brains. Well, we finally did it! Here's how...</p>
								</header>
								<div class="image main"><img src="images/me_and_my_brain.jpg" alt="me holding a 3d printed copy of my brain" /></div>
								<p>When I 3D-printed my brain, I loosely followed this <a href="https://www.instructables.com/id/3D-print-your-own-brain/">guide found on Instructables</a>. 
									I've included my own detailed instructions below. They assume some <a href="https://ryanstutorials.net/linuxtutorial/">basic level of comfort with Linux commands and navigating a computer through a Terminal</a>. Moreover, this
									process requires some sort of access to a 3D-printer and some patience while working with unfriendly software. Also, this method gives you a print of the cortical surface, but leaves out the cerebellum and brainstem. Maybe someday, 
									I'll look into printing the entire structure... If you have any questions or want to show off your own finished product, send me an email!</p>
								<h3>Step 0: Setup Your Computer</h3>
								<p>In order to reformat your MRI scan so that it's suitable for printing, you'll need to set up your computer to run Freesurfer and Meshlab.</p>
								<ul>
									<li><b><a href="http://freesurfer.net/">Freesurfer</a></b></li>
									<p>If you are working on a Mac or Linux machine, you can download Freesurfer directly onto that machine. Freesurfer is not compatible 
										with Windows, but I've heard people use VirtualBox to create a Linux environment on their windows machine. If you're lucky, your 
										university or workplace already has Freesurfer installed on a compute cluster (things will run a lot faster).</p>
									<li><b><a href="http://www.meshlab.net/">Meshlab</a></b></li>
									<p>Before printing my brain, I had never heard of Meshlab, but I found it relatively easy to use and install. You can download Meshlab directly
										from <a href="http://www.meshlab.net">their website</a>.</p>
								</ul>
								<h3>Step 1: Get an MRI Scan</h3>
								<p>Don't have access to a scan of your brain? Check out the teaching hospitals and universities near you. Chances are, they have
									some ongoing research studies that you can volunteer for. You'll want a T1-weighted image of your full brain. (Supposedly,
									a T2-weighted image will also work.) If you ask, the experimenter can usually send you a copy of your structural scan on a CD
									or flashdrive.
									<ul>
									<li><b>Load the Data onto Your Computer</b></li>
									<p>This step is mostly up to you and your personal preference. You'll want to create a folder somewhere that is easily accessible for later.
										This might be on the Desktop if you're using a personal computer, or somewhere on a shared directory if you're using a compute cluster.</p>
									<li><b>"Unpack" Your Scan</b></li>
									<p>The image will probably come in DICOM format. This means that each "slice" of the brain image will be stored as a separate file
										with the extension <code>.dcm</code>. The filenames will usually be a long string of computer-generated numbers and they should 
										all be in the same folder. To make the scan easier to work with, we will convert it to standard NIFTI (<code>.nii</code>) format.
										You can use a program like <code>dcmunpack</code> to convert to NIFTI (.nii) format. Here is an example of how I run dcmunpack: </br>
										First, change directories to the location of the folder that contains your DICOMs</p>
										<pre><code>~$ cd /location/of/DICOMs
~$ ls
   folder_of_dicoms
   anotherfile.txt
   file.txt
~$ dcmunpack -src . -targ my_brain_unpacked -run 1 anat nii anat.nii</pre></code>

									</ul>
								<h3>Step 2: Create a Surface File</h3>
									<ul>
									<li><b>Set Up Your Subject Directory</b></li>
									<p>You'll want to use <a href="http://freesurfer.net/">Freesurfer</a> to convert your 3D image into surface files. You'll run the <code>recon_all</code>
										command to do this. (<code>recon_all</code> can take a day or more to run, depending on the type of computer you are using.)</p>
									<li><b>Run recon-all</b></li>
									<p>The documentation for Freesurfer's <code>recon-all</code> command can be found <a href="https://surfer.nmr.mgh.harvard.edu/fswiki/recon-all"> here.</a> 
										This command can be tricky to run if you're not familiar with Freesurfer, so don't hesitate to consult your local Freesurfer guru (or Google) with questions.
										First, you'll want to set up your scan with the standard Freesurfer directory structure. It should look something like this:</p>
										<pre><code>+ subject_name
|   +-- mri
|   |   +-- orig
|   |   |   +-- 001.nii</pre></code>
										<p> The file, <code>001.nii</code> is your brain scan that you unpacked earlier. Before we run <code>recon-all</code> we just need to convert the file to
											<code>.mgz</code> format with the following command: <code>mri_convert 001.nii 001.mgz</code>. Also, you'll want to update the enviromental variable 
											<code>SUBJECTS_DIR</code> and set it to the location of your subject_name folder in the directory structure I outlined above. (e.g. <code>export SUBJECTS_DIR=/path/to/subjects_directory</code>)
										Now you're ready to run the <code>recon-all</code> command! I recommend that you run this on a compute cluster if you can, to speed things up. Even on a cluster, you might be looking at upwards of a 10-hour runtime, 
										depending on your settings. The command I run is this: <code>recon-all -all -subjid subject_name</code>.
										When the command has finished, you should see a folder <code>subject_name/surf</code>. There will be a ton of files in this folder. The two you are interested in are <code>lh.pial</code> and <code>rh.pial</code>. You can
										open them in Freeview (Freesurfer's viewing tool) to see a rough idea of what your 3D-printed brain will look like. In the next steps, you'll do some file-conversion and cleanup to prepare the images for printing!
										</p>
									</ul>
								<h3>Step 3: Reformat for 3D-Printing</h3>
									<ul>
									<li><b>Convert to .stl Format</b></li>
									<p>Using  <code>mri_convert</code> again, you can convert the surface files to ".stl" format. This is the file format used by most 3D-printers.
										Then, using a program called <a href="http://www.meshlab.net/">Meshlab</a> (freely downloadable online) you will need to combine the 
										two hemispheres into a single file and "smooth" the surface in order to get a nice print.</p>
									<li><b>Load Into Meshlab</b></li>
									<p>You'll use Meshlab to combine the two hemispheres into a signle file, and smooth out the edges a bit. To import the files into Meshlab,
										click "File -> Import Mesh" and select the <code>.stl</code> files for each hemisphere. Now, because the shape of the surface files
										is very complex, we do a little bit of smoothing to simplify the file and make it easier to print. To do so, click "Filters -> Remeshing, 
										Simplification, and Reconstruction -> Simplification: Quadratic Edge Collapse Decimation. In the screen that pops up, enter 150,000 into
										 the "number of faces" field and click OK. Finally the <a href="https://www.instructables.com/id/3D-print-your-own-brain/">Instructables Tutorial</a> suggests adding a second round of smoothing 
										 with "Filters -> Smoothing, Fairing, and Deformation -> Laplacian Smooth." Personally, I thought this erased too many of the imperfections
										 so I opted out of this step, but it shouldn't make too much of a difference.</p>
									</ul>
								<h3>Step 4: Send it to the 3D-Printer!</h3>
								<p>At my university, I was able to send the .stl file over to the engineering department, where they have a 3D printer available for students.
									If you don't have access to a 3D printer at your school, home, or work, there are websites that will print an .stl file for you
									and then send the finished product in the mail (though, this can get quite expensive). I'd also suggest that you look for a "Makerspace"
									in your local community. These sorts of "open workshops" are popping up more and more - giving local artists and hobbyists access
									to an assortment of shared tools, often including 3D printers. When you print your brain, you'll need to specify the scale. My MRI had a
									voxel size of 1 x 1 x 1mm, and at a 1:1 scale, my entire 3D-printed brain measured about 100 x 100 x 150mm.</p>
								<h3>The Finished Product</h3>
								<div class="image left"><img src="images/3d_brains.jpg" alt="my brain, along with my coworker's brain, fresh out of the printer!" /></div>
								<p>Overall, I was pretty impressed with how the print came out. In the image, you can see my brain printed in white, and Matt's brain printed in
									olive green. Since we got the prints done for free from the Engineering department, we didn't get to pick the color, but I think both colors
									look great regardless. When I picked up the brains from the printer, they were still wet, so I left them out on some paper towels overnight.
									We've talked about creating some sort of pedastil or something to display these models in the all the glory they deserve... we'll see! Happy printing!</p>
							</section>

					</div>

				<!-- Footer, Copyright -->
				<div w3-include-html="footer.html"></div>

			</div>

		<!-- Scripts -->
			<script>w3.includeHTML();</script>
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>